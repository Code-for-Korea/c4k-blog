---
layout: page

# All the Tags of posts.
# v2.0
# https://github.com/cotes2020/jekyll-theme-chirpy
# © 2017-2019 Cotes Chung
# MIT License
---

<!-- Editor's Dependecy Style -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.min.css"/>
<!-- Editor's Style -->
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css"/>
<link rel="stylesheet" href="https://uicdn.toast.com/tui.chart/latest/tui-chart.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css"/>
<link rel="stylesheet" href="https://uicdn.toast.com/tui-color-picker/latest/tui-color-picker.min.css"/>

<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<!-- Editor's Plugin -->
<script src="https://uicdn.toast.com/editor-plugin-table-merged-cell/latest/toastui-editor-plugin-table-merged-cell.min.js"></script>
<script src="https://uicdn.toast.com/editor-plugin-chart/latest/toastui-editor-plugin-chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="https://uicdn.toast.com/editor-plugin-code-syntax-highlight/latest/toastui-editor-plugin-code-syntax-highlight-all.min.js"></script>
<script src="https://uicdn.toast.com/editor-plugin-color-syntax/latest/toastui-editor-plugin-color-syntax.min.js"></script>

<article class="d-none">
    <input type="hidden" id="author">
    <div class="input-group mb-2">
        <div class="input-group-prepend">
            <label class="input-group-text" for="categories_1st"><i class="fas fa-list"></i></label>
        </div>
        <select class="custom-select" id="categories_1st">
            <option selected>공공데이터</option>
            <option>시빅해킹</option>
            <option>프로젝트</option>
        </select>
        <select class="custom-select" id="categories_2st">
        </select>
    </div>

    <div class="input-group mb-2">
        <div class="input-group-prepend">
            <span class="input-group-text" id="basic-addon2"><i class="fas fa-tag"></i></span>
        </div>
        <input id="tags" type="text" class="form-control" placeholder="Tags" aria-label="Tags"
               aria-describedby="basic-addon2">
    </div>

    <input type="text" class="form-control" placeholder="Title" id="title">

    <div id="editor" class="mt-2 mb-2"></div>
    <div class="d-flex justify-content-between" role="group" aria-label="게시글 에디터 버튼">
        <input type="button" class="btn btn-outline-secondary" value="로그아웃" id="btn-logout">
        <input type="button" class="btn btn-primary" value="작성" id="btn-write">
    </div>
    <span class="ml-1 align-bottom text-muted" id="login_user"></span>
</article>

<article class="d-none">
    <a href="https://github.com/login/oauth/authorize?client_id=Iv1.59d98a5dcc950907">
        <button style="display: block; border: 0px none; border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.5) 0px 1px 2px; color: rgb(255, 255, 255); cursor: pointer; font-size: 19px; margin: 5px; width: calc(100% - 10px); overflow: hidden; padding: 0px 10px; user-select: none; height: 50px; background: rgb(51, 51, 51) none repeat scroll 0% 0%;">
            <div style="align-items: center; display: flex; height: 100%;">
                <div style="display: flex; justify-content: center; min-width: 26px;">
                    <svg fill="#FFFFFF" role="img" viewBox="0 0 24 24" width="26px" height="26px"
                         xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path>
                    </svg>
                </div>
                <div style="width: 10px;"></div>
                <div style="text-align: left; width: 100%;">Login with GitHub</div>
            </div>
        </button>
    </a>
</article>


<script type="text/javascript">
    let editor = null;

    function initEditor() {
        const chartOptions = {
            /*
                         minWidth: 100,
                         maxWidth: 600,
                         minHeight: 100,
                         maxHeight: 300
            */
        };

        const colorSyntaxOptions = {
            /*preset: ['#181818', '#292929', '#393939'],*/
            useCustomSyntax: true
        };

        editor = new toastui.Editor({
            el: document.querySelector('#editor'),
            height: '50vh',
            /*initialEditType: 'markdown',*/
            initialEditType: 'wysiwyg',
            previewStyle: 'vertical',
            plugins: [
                toastui.Editor.plugin.tableMergedCell,
                [toastui.Editor.plugin.chart, chartOptions],
                toastui.Editor.plugin.codeSyntaxHighlight,
                [toastui.Editor.plugin.colorSyntax, colorSyntaxOptions]
            ]
        });
    }

    function renewing_access_token_with_refresh_token() {
        const xhr = new XMLHttpRequest();
        xhr.open('POST', 'https://codefor.kr:8443/api/github/oauth');
        xhr.withCredentials = true;
        xhr.onreadystatechange = () => {
            if (xhr.readyState === xhr.DONE) {
                if (xhr.status === 200 || xhr.status === 201) {
                    const json = JSON.parse(xhr.responseText);
                    if (json.data.error && json.data.error === true) {
                        alert("에러발생");
                        console.error(json);
                    } else {
                        create_new_post();
                    }
                } else {
                    console.error(xhr.responseText);
                }
            }
        };

        xhr.send(null);
    }

    function create_new_post() {
        const xhr = new XMLHttpRequest();
        xhr.open('POST', 'https://codefor.kr:8443/api/github/post');
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.withCredentials = true;
        xhr.onreadystatechange = () => {
            if (xhr.readyState === xhr.DONE) {
                if (xhr.status === 200 || xhr.status === 201) {
                    const json = JSON.parse(xhr.responseText);
                    if (json.data.error && json.data.error === true) {
                        if (json.data.status === 401) {
                            renewing_access_token_with_refresh_token();
                        } else {
                            alert("에러발생");
                            console.error(json);
                        }
                    } else {
                        location.reload();
                    }
                } else {
                    console.error(xhr.responseText);
                }
            }
        };

        xhr.send(JSON.stringify({
            "author": document.getElementById('author').value,
            "categories": [
                document.getElementById('categories_1st').value,
                document.getElementById('categories_2st').value
            ],
            "content": editor.getMarkdown(),
            "tags": document.getElementById('tags').value.split(','),
            "title": document.getElementById('title').value
        }));
    }

    function initElements() {
        document.getElementById('btn-write').addEventListener('click', create_new_post);

        document.getElementById('btn-logout').addEventListener('click', () => {
            const xhr = new XMLHttpRequest();
            xhr.open('DELETE', 'https://codefor.kr:8443/api/github/authorize');
            xhr.withCredentials = true;
            xhr.onreadystatechange = () => {
                if (xhr.readyState === xhr.DONE) {
                    if (xhr.status === 200 || xhr.status === 201) {
                        const json = JSON.parse(xhr.responseText);
                        console.log(json);
                        location.reload();
                    } else {
                        console.error(xhr.responseText);
                    }
                }
            };
            xhr.send(null);
        });

        document.getElementById('categories_1st').addEventListener('change', category_change);
        category_change();
    }

    function category_change() {
        const categories = {
            '일반': ['일반'],
            '공공데이터': ['일반'],
            '시빅해킹': ['일반'],
            '프로젝트': ['Meet & Hack', '개인 안심번호']
        };

        const category_1st = $('#categories_1st').val();

        $('#categories_2st').empty();

        $(categories[category_1st]).each(function (index, item) {
            const option = $(document.createElement('option'));
            option.text(item);
            $('#categories_2st').append(option);
        });
    }

    /*
        initEditor();
        initElements();
        document.getElementsByTagName('article')[0].className = 'd-block';
    */

    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'https://codefor.kr:8443/api/github/authorize');
    xhr.withCredentials = true;
    xhr.onreadystatechange = () => {
        if (xhr.readyState === xhr.DONE) {
            if (xhr.status === 200 || xhr.status === 201) {
                const json = JSON.parse(xhr.responseText);
                const profile = json.data.profile;
                const articles = document.getElementsByTagName('article');
                /*에러가 있으면 OAuth 출력*/
                if (json.data.error && json.data.error === true) {
                    articles[1].className = 'd-block';
                } else {
                    initEditor();
                    initElements();
                    articles[0].className = 'd-block';
                    document.getElementById('author').value = profile.id;
                    const user =
                        profile.name === ""
                            ? profile.login
                            : profile.name + '(' + profile.login + ')';
                    document.getElementById('login_user').innerText = 'logged in ' + user;
                }
            } else {
                console.error(JSON.parse(xhr.responseText));
            }
        }
    };

    xhr.send(null);
</script>